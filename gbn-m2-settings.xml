<!--
Maven settings file to point at a specific GBN.

To build your CDH component against a specific
Global Build Number (GBN), use this Maven
settings file with "mvn -s gbn-m2-settings.xml" and
the environment variable CDH_GBN=... set.

For example, to build against the latest build,

$ export CDH_GBN=$(curl 'http://builddb.infra.cloudera.com:8080/query?product=cdh&user=jenkins&version=6.x&tag=official')
$ mvn -s gbn-m2-settings.xml install

This file shares some implementation with
the Cauldron local-build-m2-settings.xml settings
file, which uses a file-based repo.
-->
<settings>
  <mirrors>
    <!--
        Cauldron repo is a virtual Artifactory repo which should serve the
        necessary artifacts to perform a complete build. The special
        property of the cauldron repo though is the inability to resolve
        any -SNAPSHOT artifacts, e.g.
        org.apache.hadoop:hadoop-client:jar:2.6.0-mr1-cdh5.8.0-SNAPSHOT.

        This prevents the build from picking up any leaked artifacts.
    -->
    <mirror>
      <mirrorOf>external:*,!cauldron.gbn.repo</mirrorOf>
      <name>cauldron-repo</name>
      <url>http://maven.jenkins.cloudera.com:8081/artifactory/cauldron-repo</url>
      <id>cauldron-repo</id>
    </mirror>
  </mirrors>
  <profiles>
    <profile>
      <id>gbn-build</id>
      <activation>
        <activeByDefault>true</activeByDefault>
      </activation>
      <properties>
        <repository.root>http://cloudera-build-us-west-1.vpc.cloudera.com/s3/build/${env.CDH_GBN}/maven-repository/</repository.root>
      </properties>
      <repositories>
        <repository>
          <id>cauldron.gbn.repo</id>
          <url>http://cloudera-build-us-west-1.vpc.cloudera.com/s3/build/${env.CDH_GBN}/maven-repository/</url>
          <name>Cauldron Build GBN Repository</name>
          <snapshots>
            <enabled>true</enabled>
          </snapshots>
        </repository>
      </repositories>
      <!-- We define plugin repositories same as regular repositories, since we build
           at least one plugin. (avro-maven-plugin) -->
      <pluginRepositories>
        <pluginRepository>
          <id>cauldron.gbn.repo</id>
          <url>http://cloudera-build-us-west-1.vpc.cloudera.com/s3/build/${env.CDH_GBN}/maven-repository/</url>
          <name>Cauldron Build GBN Repository</name>
          <snapshots>
            <enabled>true</enabled>
          </snapshots>
        </pluginRepository>
      </pluginRepositories>
    </profile>
  </profiles>
  <activeProfiles>
    <activeProfile>gbn-build</activeProfile>
  </activeProfiles>
</settings>
